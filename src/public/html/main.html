<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="/css/main.css">
  <script src="https://unpkg.com/pdf-lib@1.4.0"></script>
  <script src="https://unpkg.com/downloadjs@1.4.7"></script>
  <script src="/components/topnav.js" type="text/javascript" defer></script>
</head>

<body>
  <topnav-component></topnav-component>
  <div id="template-div">
    <h2>Templates</h2>
    <a href="/editor" id="editor-link" class="editor-link" title="Add new template">
      <img src="/plus.png" alt="" width="24px" height="24px" >
    </a>
  </div>
  <div id="template-list"></div>
</body>
<script>
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);

  const email = urlParams.get('email');
  const firstName = urlParams.get('firstName');
  const lastName = urlParams.get('lastName');
  
  document.getElementById("editor-link").href += `?email=${email}&firstName=${firstName}&lastName=${lastName}`;

  fetch(`/api/pdf-templates/${email}`, {
    method: "GET",
    headers: {
      "Content-type": "application/json; charset=UTF-8"
    }
  })
  .then(response => response.json())
  .then(json => {
    const pdfList = document.getElementById("template-list");

    for (let i = 0; i < json.length; i++) {
      const pdfItem = document.createElement("div");
      pdfItem.classList.add("pdf-item");
      
      const docImage = document.createElement("img");
      docImage.src = "/doc.png";
      docImage.classList.add("doc-image");
      pdfItem.appendChild(docImage);

      const editButton = document.createElement("button");
      editButton.innerText = "Edit";
      editButton.classList.add("edit-button");
      // editButton.href = `/editor?email=${email}&firstName=${firstName}&lastName=${lastName}&id=${json[i].id}`;
      editButton.onclick = (() => {
        window.location = `/editor?email=${email}&firstName=${firstName}&lastName=${lastName}&id=${json[i].id}`;
      });
      // pdfItem.appendChild(editButton);

      const deleteButton = document.createElement("button");
      deleteButton.innerText = "Delete";
      deleteButton.classList.add("delete-button");

      deleteButton.onclick = (() => {
        fetch(`/api/pdf-templates/${email}/${json[i].id}`, {
          method: "DELETE",
          headers: {
           "Content-type": "application/json; charset=UTF-8"
          }
        })
        .then(response => response.json())
        .then(json => {
          if (json.status === 200) {
            pdfList.removeChild(pdfItem);
          }
        });
      });

      const filename = document.createElement("div");
      filename.classList.add("filename");
      filename.innerText = json[i].filename;
      
      const buttons = document.createElement("div");
      buttons.classList.add("buttons-div");
      buttons.appendChild(editButton);
      buttons.appendChild(deleteButton);

      const info = document.createElement("div");
      info.classList.add("info");
      info.appendChild(filename);
      info.appendChild(buttons);

      pdfItem.appendChild(info);

      pdfList.appendChild(pdfItem)
    }
  });
  
  window.onload = (() => {
    setParams();
  });
</script>

</html>